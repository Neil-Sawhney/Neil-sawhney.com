<!DOCTYPE html>
<html lang="en">

<head>
    <!-- META -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,
            maximum-scale=1, user-scalable=no">


    <!-- PAGE TITLE -->
    <title>How to Use Symbolic Python to Solve and Visualize Dynamical Systems</title>


    <!-- FAVICON -->
    <link rel="icon" type="image/png" href="../../assets/images/favicon.jpg">


    <!-- GOOGLE FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel="stylesheet">


    <!-- STYLESHEETS -->
    <link rel="stylesheet" type="text/css" href="../../assets/css/plugins.css">
    <link rel="stylesheet" type="text/css" href="../../assets/css/style.css">
    <link rel="stylesheet" type="text/css" href="../../assets/css/elements.css">
    <link rel="stylesheet" type="text/css" href="../../assets/css/colors.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/style.css">
</head>

<body>


    <!-- LOADING SCREEN -->
    <div class="loading-screen">

        <!-- INNER-->
        <div class="inner">
            <div class="text-box">
                <h3>Neil Sawhney</h3>
            </div>
            <div class="line-frame">
                <div class="line"></div>
            </div>
        </div>
        <!-- /INNER-->

    </div>
    <!-- /LOADING SCREEN -->


    <!-- MENU BUTTON -->
    <div class="m-menu-button">

        <!-- BURGER -->
        <div class="burger">
            <div class="line"></div>
            <div class="line"></div>
        </div>
        <!-- /BURGER --> = 0
    </div>
    <!-- /MENU BUTTON -->


    <!-- MENU -->
    <div class="m-menu">


        <!-- MENU INNER -->
        <div class="m-menu-inner noselect">


            <!-- MENU ITEMS -->
            <div class="head m-b-2">
                <p class="small">Menu</p>
            </div>
            <ul class="main-items">

                <li><a href="../../index.html#intro"><span class="ti-location-pin"></span>
                        <p class="small">Home</p>
                    </a></li>
                <li><a href="../../index.html#about"><span class="ti-user"></span>
                        <p class="small">About</p>
                    </a></li>
                <li><a href="../../index.html#articles"><span class="ti-user"></span>
                        <p class="small">Articles</p>
                    </a></li>
                <li><a href="../../index.html#portfolio"><span class="ti-view-grid"></span>
                        <p class="small">Portfolio</p>
                    </a></li>
                <li><a href="../../index.html#resume"><span class="ti-align-left"></span>
                        <p class="small">Resume</p>
                    </a></li>
                <li><a href="../../index.html#contact"><span class="ti-comments"></span>
                        <p class="small">Contact</p>
                    </a></li>

            </ul>
            <!-- /MENU ITEMS -->


            <!-- SOCIAL ITEMS -->
            <div class="head m-b-2 m-t-7">
                <p class="small">Social</p>
            </div>
            <div class="social-items">

                <div class="item"><a href="https://www.linkedin.com/in/neil-sawhney-b16547224/" target="_blank"><span class="ti-linkedin"></span></a></div>
                <div class="item"><a href="https://github.com/Neil-Sawhney" target="_blank"><span class="ti-github"></span></a></div>
            </div>
            <!-- /SOCIAL ITEMS -->


        </div>
        <!-- /MENU INNER -->


    </div>
    <!-- /MENU -->

    <!-- MAIN -->
    <div id="main">

        <!-- INNER CONTENT -->
        <div class="content m-l-3 m-t-5 m-r-3">


            <!-- /SECTION ( TITLE ) -->
            <div class="title">
                <h2 class="colors_sweet_purple">How to Use Symbolic Python to Solve and Visualize Dynamical Systems</h2>
                <p class="colors_dreamy_turquoise">-Neil Sawhney</p>
                <div class="seperator-line m-t-2"></div>
            </div>
            <!-- /SECTION ( TITLE ) -->

            <p class="m-t-6 color-white"> If you've worked with some advanced dynamics problems, you'll know that it's often next to impossible to derive the equations of motion by hand.</p>
            
            <p class="m-t-6">While most courses will teach you how to solve these kinds of systems using matrices in matlab or python, I'll show you how to use the Sympy.physics.mechanics module in python to solve for the equations of motion symbolically.</p>
            
            <p class="m-t-2">These can then be visualized by numerical integration of the equations of motion. Below is a visualization I made of a basketball spinning on a finger, which we will use as an example.</p>

            <iframe class="m-t-6 simulation" src="./basketball-on-finger/index.html" width="70%" height="700rem"></iframe>

            <div class="pros_cons_container m-t-3">

                <h3>Pros of using this method</h3>
                <ul>
                    <li class="m-t-2">
                        <p>PlatformIO is versatile and can be used for programming a vast variety of microcontrollers and development boards in almost any language and framework, as opposed to MPLAB which is only used for programming their microcontroller families.</p>
                    </li>
                    <li class="m-t-2">
                        <p>If you're an avid programmer, there's a high chance you're already using and familiar with VSCode as opposed to MPLAB. Instead of learning many different ide's for each purpose, you can use one.</p>
                    </li>
                </ul>


                <h3>Cons of using this method</h3>
                <ul>
                    <li class="m-t-2">
                        <p>MPLAB provides official, dedicated support and seamless compatibility with Microchip's microcontrollers.</p>
                    </li>
                    <li class="m-t-2">
                        <p>Built-in tools in MPLAB are tailored for Microchip's devices, offering better integration than PlatformIO and VSCode.</p>
                    </li>
                </ul>

            </div>


            <p class="m-t-6 color-white"> There are good motives for both methods, but personally I prefer the VSCode route. Unfortanately i've found this method to be somewhat tricky to get started without lots of research, despite being extremely simple. Hopefully this article solves that problem.</p>

            <h3 class="m-t-6"> Some prerequisites/supplies to follow this guide:</h3>


            <!-- PREREQUISITES -->
            <div class="pills m-b-5 m-t-3">

                <div class="pill">
                    <p>VSCode installed + familiarity of the basics</p>
                </div>
                <div class="pill">
                    <p>Basic breadboarding ability</p>
                </div>
                <div class="pill">
                    <p>An AVR Microntroller</p>
                </div>
                <div class="pill">
                    <p>A Programmer for the Microcontroller (can be any arduino or esp)</p>
                </div>

            </div>
            <!-- /PREREQUISITES -->
            <h3 class="step"> Step 1: Install The PlatformIO Extension in VSCode</h3>
            <img class="w-7" src="./assets/images/platformIOExtension.png" alt="">


            <h3 class="step">OPTIONAL STEP: Set up an arduino or esp as a programmer</h3>
            <p class="m-t-3">Dont have a programmer? Neither do I, but I do have a ton of arduinos and esp32's and esp8266's laying around, so lets convert one of those into an AVRISP programmer.</p>
            <p class="m-t-3">I'm using an esp8266 mounted on a WeMos D1 mini Dev board.</p>
            <p class="m-t-3">Lucky for us, code to make our board act as an AVRISP is provided to us by the arduino foundation as example code. You can go ahead and pull up that example code in the Arduino IDE, make the neccessary pin changes, and upload it. That being said, we have platformIO now, so let's get some practice using that instead.</p>
            <p class="m-t-3 color-white">Download the arduino example code from the following <a class="externLink" href="https://gist.github.com/srmq/0217a2844a9d82a6913ff989472a98dd" target="_blank">github repo.</a></p>
            <p class="m-t-3 color-white"> In VSCode, Click the PlatformIO icon (the alien) in the bottom left corner of VSCode and click "PIO Home → Open" under QUICK ACCESS.</p>
            <p class="m-t-3">If you're using an esp family board, make sure to install the correct platform for that board, in my case it is the "Espressif 8266" platform. Click on "Platforms" on the left, then "Embedded" on the top, then finally find and click on "Espressif 8266" and install it.
            <p class="m-t-3 color-white">Click on "Import Arduino Project", and select the place in which you saved the example code (make sure to unzip it first). Also select your board in the dropdown, in my case, I've selected "WeMos D1 R2 and mini (WEMOS). Click "Import".</p>
            <img src="./assets/images/importArduino.png" alt="">
            <p class="m-t-3 color-white">Find the following lines of code in the folder named "src".</p>
            <pre><code>
// The standard pin configuration.
#ifndef ARDUINO_HOODLOADER2

#define RESET     10 // Use pin 10 to reset the target rather than SS
#define LED_HB    9
#define LED_ERR   8
#define LED_PMODE 7

            </pre></code> 
            <p class="m-t-3">GPIO7 - 10 on my board is not accessible, so I changed this to the following, note that the D infront of the number specifies that i'm referring to the digital pin (the label on the dev board) and not the gpio pin.</p>
            <pre><code>
// The standard pin configuration.
#ifndef ARDUINO_HOODLOADER2

#define RESET     D8 // Use pin 10 to reset the target rather than SS
#define LED_HB    D1
#define LED_ERR   D2
#define LED_PMODE D3
            </pre></code>
            <p class="m-t-3">Wire LED's to the defined LED pins for some extra debugging info during programming.</p>
            <p class="m-t-3 color-white">You may have to add the following lines to your platformio.ini with your boards upload speed, and the com port that your board is plugged into.</p>
            <pre><code>
upload_speed = 9600
upload_port = COM10
            </pre></code>
            <p class="m-t-3 color-white"> Otherwise, That's it for the programmer software! Go ahead and upload the code! You can do so by clicking ctrl-alt-u or finding the dropdown next to the checkmark in the top right, and pressing "Upload".</p>

            <p class="m-t-3 color-white">All that's left is to connect the MOSI, MISO, SCK, VCC, GND and the RESET pin (which we just defined) on your programmer to the respective pins on your microcontroller. You should be able to find this by googling the pinout of the two boards. Here is the wiring for the ATMega8 to the WeMoS D1 mini.</p>
            <dev class="flex">
                <img src="./assets/images/ATMEGA8toAVRISP.jpg" alt="">
                <img src="./assets/images/WeMosD1mini.jpg" alt="">
            </dev>



            <h3 class="step"> Step 2: Create a new project</h3>
            <p class="m-t-3 color-white"> Click the PlatformIO icon (the alien) in the bottom left corner of VSCode and click "PIO Home → Open" under QUICK ACCESS.</p>
            <p class="m-t-3">We need to add the Atmel AVR Platform so that we can get access to all the necessary libraries for using the IO Ports on our microcontroller. This also automatically defines certain board specific variables that will help make uploading work properly.</p>
            <p class="m-t-3 color-white" id="platformInstall">Click on "Platforms" on the left, then "Embedded" on the top, then finally find and click on "Atmel AVR" and install it. The default version should be fine.</p>
            <div class="flex">
                <img src="./assets/images/AtmelPlatform.png" alt="">
                <img src="./assets/images/install.png" alt="">
            </div>
            <p class="m-t-6 color-white">Sweet, now lets create our new project. Go back to "PIO Home → Open", and click the "New Project" button.</p>
            <p class="m-t-6 color-white">Name the project whatever you want. In my case my board is an ATmega8, but select whichever board you are using. Feel free to change the location your project is saved by unchecking the "Use default location" box. Click Finish.</p>
            <img src="./assets/images/createProject.png" alt="">


            <h3 class="step">Step 3: Edit the platformio.ini file in your project</h3>
            <p class="m-t-3 color-white">First thing's first, if you dont want to use the arduino framework, delete the following line.</p>
            <pre><code>
framework = arduino
            </code></pre>
            <p class="m-t-3">We're going to blink an led here, so the arduino framework is wayyy overkill... deleted.</p>
            <p class="m-t-3 color-white">I happen to be using an esp8266 programmed to act as an AVRISP, so from the <a class="externLink" href="https://docs.platformio.org/en/stable/platforms/atmelavr.html">PlatformIO documentation for Atmel AVR boards</a>, lets grab all the juicy stuff under "AVRISP" in the "Configuration for the programmers" section.</p>
            <pre><code>
upload_protocol = custom
upload_port = SERIAL_PORT_HERE
upload_speed = 19200
upload_flags =
    -C
    ; use "tool-avrdude-megaavr" for the atmelmegaavr platform
    ${platformio.packages_dir}/tool-avrdude/avrdude.conf
    -p
    $BOARD_MCU
    -P
    $UPLOAD_PORT
    -b
    $UPLOAD_SPEED
    -c
    stk500v1
upload_command = avrdude $UPLOAD_FLAGS -U flash:w:$SOURCE:i
            </pre></code> 
            <p class="m-t-3">Change the words "SERIAL_PORT_HERE" with the serial port your programmer is plugged into. In my case it's COM3.</p>
            <p class="m-t-3 color-white">Almost done, all that's left is to add 2 <strong style="font-size: 5rem;">extremely important</strong> lines.</p>
            <p class="m-t-3 color-white">We need to tell platformIO the clock frequency of our chip, and whether we plan on using the internal oscillator, or if we plan to wire up an external one. By default, plaformIO assumes the cpu fqz is 16MHz, the ATMega8 that I am using has an 8MHz internal oscillator. PlatformIO assumes the oscillator is external by default. </p>
            <p class="m-t-3"> This is all in the documentation, but I bricked a microcontroller anyway by not paying close attention to this. If you do not set this correctly, your microcontroller will not be able to communicate with your computer! Check the documentation of your microcontroller!</p>

            <p class="m-t-3 color-white">We need to add the following two lines, make sure to change the cpu and oscillator type to your needs.</p>
            <pre><code>
board_build.f_cpu = 8000000L
board_hardware.oscillator = internal
            </pre></code>
            <p class="m-t-3 color-white">Here is my entire platform.ini file.</p>
            <pre><code>
[env:ATmega8]
platform = atmelavr
board = ATmega8
upload_protocol = custom
upload_port = COM3
upload_speed = 19200
board_build.f_cpu = 8000000L
board_hardware.oscillator = internal
upload_flags =
    -C
    ; use "tool-avrdude-megaavr" for the atmelmegaavr platform
    ${platformio.packages_dir}/tool-avrdude/avrdude.conf
    -p
    $BOARD_MCU
    -P
    $UPLOAD_PORT
    -b
    $UPLOAD_SPEED
    -c
    stk500v1
upload_command = avrdude $UPLOAD_FLAGS -U flash:w:$SOURCE:i
            </pre></code>


            <h3 class="step"> Step 4: Create a Program</h3>
            <p class="m-t-3 color-white">Click on the folder named "src" to reveal its contents. You should see that platformIO rudely put disgusting arduino code here in a file called main.cpp. If you want to use the arduino framework, go ahead, but we're going to go ahead and delete that file.</p>
            <p class="m-t-3 color-white">Create a new file under src called main.c. </p>
            <p class="m-t-3">It's also possible to use assembly or cpp, but I'm going to use C for this tutorial.</p>
            <p class="m-t-3 color-white">The following code blinks an LED on PD6 of the ATMega8, slap whatever you want in main if you had bigger plans in mind.</p>
            <pre><code>
#include &ltavr/io.h>
#include &ltutil/delay.h>

int main()
{

    DDRD |= (1 &lt&lt PD6); // make PD6 an output

    while (1)
    {
        PORTD |= (1 &lt&lt PD6);  // turn on led at PD6
        _delay_ms(500);      // delay for a second
        PORTD &= ~(1 &lt&lt PD6); // turn off led at PD6
        _delay_ms(500);      // delay for a second
    }

    return 0; // the program executed successfully
}
            </pre></code>



            <h3 class="step">Step 5: Set Fuses</h3>
            <p class="m-t-3">This is the scary part that could destroy your micrcontroller. Double tripple check that you set your cpu fqz and oscillator type correctly in the platform.ini file. Rest assured, the name "fuse" is a misnomer, as long as you can still communicate with the chip, you'll be able to change the fuse values again later, incase you decide later that you do or dont want to use an external oscillator.</p>
            <p class="m-t-3 color-white">Click the alien in the bottom left, then navigate to the Set Fuses button and give it a click. Note, if you want to use the arduino framework, you'll also have to click the burn bootloader button.</p>
            <img src="./assets/images/fuses.png" alt="">


            <h3 class="step">Step 5: Upload your code</h3>
            <p class="m-t-3 color-white">Yay! Just press ctrl-alt-u, or find the "upload" button in the top right corner, or above the set fuses button, or in any of the other places its probably hidden to upload your code (which builds first by default) and watch that led blink!</p>
            <p class="m-t-3 color-white">Note that your microcontroller won't actually execute the code until you disconnect the Reset pin on the microcontroller from your programmer. For this reason i've wired a push button inbetween the reset pin of my programmer and microcontroller in the normally open configuration. This makes it so that you can leave everything plugged into the breadboard, and all you have to do is hold down the button when the code is uploading.</p>

            <div style="height: 10rem;">  </div>
        </div>


    </div>


    <!-- JAVASCRIPT FILES -->
    <script src="./assets/js/plugins.js"></script>
    <script src="../../config.js"></script>
    <script src="./assets/js/script.js"></script>

</body>